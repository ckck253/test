<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Coding Class</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --bg-color: #0f172a;
      --text-color: #cbd5e1;
      --accent-color: #38bdf8;
      --form-bg: #1e293b;
      --button-bg: #0ea5e9;
      --error-color: #f87171;
    }

    body.light {
      --bg-color: #f0f4f8;
      --text-color: #1e293b;
      --accent-color: #0ea5e9;
      --form-bg: #ffffff;
      --button-bg: #38bdf8;
      --error-color: #e11d48;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Fira Code', monospace;
      background: var(--bg-color);
      color: var(--text-color);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      background: var(--form-bg);
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      max-width: 500px;
      width: 100%;
    }
    h1, h2 {
      text-align: center;
      color: var(--accent-color);
      margin-bottom: 1rem;
    }
    label {
      font-weight: bold;
    }
    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: none;
      background: #f1f5f9;
    }
    button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: none;
      background: var(--button-bg);
      color: var(--bg-color);
      font-weight: bold;
      cursor: pointer;
    }
    #error-msg { color: var(--error-color); text-align: center; margin: 10px 0; }
    .toggle-theme {
      text-align: right;
      font-size: 0.9em;
      cursor: pointer;
      margin-bottom: 10px;
    }
    .log {
      background: #334155;
      padding: 10px;
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="toggle-theme" onclick="toggleTheme()">Toggle Theme</div>
    <div id="login-box">
      <h1>Login</h1>
      <label>Username</label>
      <input type="text" id="username">
      <label>Password</label>
      <input type="password" id="password">
      <button onclick="login()">Login</button>
      <div id="error-msg"></div>
    </div>

    <div id="dashboard" style="display:none">
      <h2>Welcome, <span id="student-name"></span></h2>
      <p>Class every Monday at 8:30 PM Lebanon / 6:30 PM UK</p>
      <button onclick="joinZoom()">Join Zoom Class</button>
      <div class="log" id="log"></div>
      <button onclick="logout()">Logout</button>
    </div>

    <div id="admin-panel" style="display:none">
      <h2>Admin Panel</h2>
      <button onclick="joinZoom()">Join Zoom</button>
      <button onclick="downloadCSV()">Export Attendance</button>
      <h3>Add Student</h3>
      <input type="text" id="new-user" placeholder="Username">
      <input type="password" id="new-pass" placeholder="Password">
      <button onclick="addStudent()">Add Student</button>
      <div class="log" id="admin-log"></div>
      <button onclick="logout()">Logout</button>
    </div>

    <form id="attendance-form" action="https://docs.google.com/forms/d/e/1FAIpQLScxFMIL7IVDoCg7kOKt1dtq0W2VQzd4WuxKL5PL8_Wbf9T3rw/formResponse" method="POST" target="dummyFrame" style="display:none">
      <input type="hidden" name="entry.523271273" id="form-name" />
    </form>
    <iframe name="dummyFrame" style="display:none;"></iframe>
  </div>

  <script>
    const users = {
      joel: { password: hash('joel123'), role: "student" },
      ali: { password: hash('ali456'), role: "student" },
      sara: { password: hash('sara789'), role: "student" },
      teacher: { password: hash('teach123'), role: "admin" }
    };

    let currentUser = "", currentRole = "";
    let attendanceLog = [];

    function hash(text) {
      return text.split('').reduce((a,b)=>a+((b.charCodeAt(0)*7).toString(36)), "");
    }

    function toggleTheme() {
      document.body.classList.toggle("light");
    }

    function login() {
      const u = document.getElementById("username").value.trim().toLowerCase();
      const p = hash(document.getElementById("password").value.trim());
      const msg = document.getElementById("error-msg");

      if (users[u] && users[u].password === p) {
        currentUser = u;
        currentRole = users[u].role;
        document.getElementById("login-box").style.display = "none";
        msg.textContent = "";
        if (currentRole === "student") showStudent();
        else showAdmin();
      } else {
        msg.textContent = "Incorrect username or password.";
      }
    }

    function showStudent() {
      document.getElementById("dashboard").style.display = "block";
      document.getElementById("student-name").textContent = currentUser;
    }

    function showAdmin() {
      document.getElementById("admin-panel").style.display = "block";
      updateAdminLog();
    }

    function joinZoom() {
      if (currentRole === "student") {
        const now = new Date().toLocaleString();
        attendanceLog.push({ name: currentUser, time: now });
        document.getElementById("log").innerHTML = `<p><strong>${currentUser}</strong> joined at ${now}</p>`;
        document.getElementById("form-name").value = currentUser;
        document.getElementById("attendance-form").submit();
        window.open("https://us05web.zoom.us/j/85772820738?pwd=a41FF2MAs6cvlSsovfJzzaG2Sh4gLP.1", "_blank");
      } else {
        window.open("https://us05web.zoom.us/j/85772820738?pwd=a41FF2MAs6cvlSsovfJzzaG2Sh4gLP.1", "_blank");
      }
    }

    function updateAdminLog() {
      document.getElementById("admin-log").innerHTML = attendanceLog.map(e => `<p>${e.name} - ${e.time}</p>`).join("");
    }

    function addStudent() {
      const u = document.getElementById("new-user").value.trim().toLowerCase();
      const p = hash(document.getElementById("new-pass").value.trim());
      if (u && p) {
        users[u] = { password: p, role: "student" };
        alert("Student added: " + u);
      }
    }

    function downloadCSV() {
      let csv = "Name,Time\n" + attendanceLog.map(e => `${e.name},${e.time}`).join("\n");
      let blob = new Blob([csv], { type: 'text/csv' });
      let url = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url;
      a.download = "attendance.csv";
      a.click();
    }

    function logout() {
      currentUser = ""; currentRole = "";
      document.getElementById("login-box").style.display = "block";
      document.getElementById("dashboard").style.display = "none";
      document.getElementById("admin-panel").style.display = "none";
      document.getElementById("log").innerHTML = "";
      document.getElementById("admin-log").innerHTML = "";
    }
  </script>
</body>
</html>
