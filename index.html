<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coding Class Login</title>
<style>
  body { font-family: Arial, sans-serif; background: #222; color: #eee; display: flex; justify-content: center; align-items: center; height: 100vh; margin:0; }
  #container { background: #333; padding: 30px; border-radius: 10px; width: 320px; }
  input, button { width: 100%; padding: 10px; margin: 8px 0; border-radius: 5px; border: none; }
  input { font-size: 16px; }
  button { background: #0af; color: white; font-weight: bold; cursor: pointer; }
  button:hover { background: #08c; }
  #error { color: #f66; text-align: center; }
  #dashboard { display: none; }
</style>
</head>
<body>

<div id="container">
  <div id="login">
    <h2>Login to Coding Class</h2>
    <input type="text" id="username" placeholder="Username" autocomplete="username" />
    <input type="password" id="password" placeholder="Password" autocomplete="current-password" />
    <button onclick="login()">Login</button>
    <div id="error"></div>
  </div>

  <div id="dashboard">
    <h2>Welcome, <span id="user-name"></span></h2>
    <p>Class every Monday at 8:30 PM Lebanon / 6:30 PM UK</p>
    <button onclick="joinZoom()">Join Zoom</button>
    <button onclick="logout()" style="margin-top: 15px; background:#f44;">Logout</button>
    <p id="log" style="margin-top: 15px; font-size: 14px;"></p>
  </div>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzlRFteXuXiZipGJl1bk7gR-YMOcjozPCts9WkKcjINE8gz9TazDfq7lWUYvjMNpxtn/exec";

let zoomLink = "";
let currentUser = "";
let currentPassword = "";

function login() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const errorDiv = document.getElementById('error');
  errorDiv.textContent = '';

  if (!username || !password) {
    errorDiv.textContent = 'Please enter username and password.';
    return;
  }

  fetch(WEB_APP_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      zoomLink = data.zoomLink;
      currentUser = username;
      currentPassword = password;
      showDashboard(username, data.role);
    } else {
      errorDiv.textContent = data.error || 'Login failed.';
    }
  })
  .catch(() => {
    errorDiv.textContent = 'Cannot connect to server.';
  });
}

function showDashboard(username, role) {
  document.getElementById('login').style.display = 'none';
  document.getElementById('dashboard').style.display = 'block';
  document.getElementById('user-name').textContent = username;

  if (role === 'admin') {
    document.querySelector('button[onclick="joinZoom()"]').style.display = 'none';
  }
  document.getElementById('log').textContent = `Logged in at ${new Date().toLocaleString()}`;
}

function joinZoom() {
  if (!zoomLink) {
    alert('Zoom link not available.');
    return;
  }

  fetch(WEB_APP_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      username: currentUser,
      password: currentPassword,
      joinClick: true
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      window.open(zoomLink, '_blank');
      document.getElementById('log').textContent = `Joined Zoom at ${new Date().toLocaleString()}`;
    } else {
      alert('Error: ' + data.error);
    }
  })
  .catch(() => alert('Failed to connect to server.'));
}

function logout() {
  currentUser = '';
  currentPassword = '';
  zoomLink = '';
  document.getElementById('login').style.display = 'block';
  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('username').value = '';
  document.getElementById('password').value = '';
  document.getElementById('error').textContent = '';
}
</script>

</body>
</html>
