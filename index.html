<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>

<script>
  // ✅ Firebase Config — replace with your actual values
  const firebaseConfig = {
    apiKey: "AIzaSyD3EXAMPLEKEY1234567890",
    authDomain: "coding-class.firebaseapp.com",
    projectId: "coding-class",
    appId: "1:1234567890:web:abcdef123456"
  };

  // ✅ Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  let currentUser = "";
  let currentRole = "";

  function login() {
    const userInput = document.getElementById("username").value.trim().toLowerCase();
    const passInput = document.getElementById("password").value.trim();
    const errorMsg = document.getElementById("error-msg");

    if (!userInput || !passInput) {
      errorMsg.textContent = "Please enter both username and password.";
      return;
    }

    const email = `${userInput}@classroom.local`;

    errorMsg.textContent = "Logging in...";

    auth.signInWithEmailAndPassword(email, passInput)
      .then(() => {
        currentUser = userInput;
        currentRole = userInput === "teacher" ? "admin" : "student";
        errorMsg.textContent = "";
        document.getElementById("login-box").style.display = "none";

        if (currentRole === "student") {
          showStudentDashboard();
        } else {
          showAdminPanel();
        }
      })
      .catch((error) => {
        errorMsg.textContent = "Login failed: " + error.message;
      });
  }

  function showStudentDashboard() {
    document.getElementById("dashboard").style.display = "block";
    document.getElementById("student-name").textContent = currentUser;

    document.getElementById("form-name").value = currentUser;
    document.getElementById("attendance-form").submit();

    const now = new Date().toLocaleString();
    const logElem = document.getElementById("log");
    logElem.innerHTML = `<p><strong>${currentUser}</strong> attendance logged at ${now}</p>`;
  }

  function showAdminPanel() {
    document.getElementById("admin-panel").style.display = "block";
    document.getElementById("admin-log").innerHTML = "<p>Attendance log not available in Firebase version.</p>";
  }

  function joinZoom() {
    window.open("https://us05web.zoom.us/j/85772820738?pwd=a41FF2MAs6cvlSsovfJzzaG2Sh4gLP.1", "_blank");
  }

  function logout() {
    auth.signOut().then(() => {
      currentUser = "";
      currentRole = "";
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
      document.getElementById("dashboard").style.display = "none";
      document.getElementById("admin-panel").style.display = "none";
      document.getElementById("login-box").style.display = "block";
      document.getElementById("log").innerHTML = "";
      document.getElementById("admin-log").innerHTML = "";
      document.getElementById("error-msg").textContent = "";
    });
  }
</script>
