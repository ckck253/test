<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Coding Class Portal</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      background: #1e293b;
      padding: 30px;
      border-radius: 10px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }
    h1 {
      text-align: center;
      color: #38bdf8;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
    }
    input {
      background: #334155;
      color: white;
    }
    button {
      background-color: #0ea5e9;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background-color: #0284c7;
    }
    .hidden {
      display: none;
    }
    .log-box {
      background: #0f172a;
      border: 1px solid #334155;
      padding: 10px;
      margin-top: 10px;
      font-size: 0.9rem;
    }
    .logout-btn {
      background: #ef4444;
    }
  </style>
</head>
<body>

  <div class="container">
    <div id="login-box">
      <h1>Coding Class</h1>
      <input type="text" id="username" placeholder="Username"/>
      <input type="password" id="password" placeholder="Password"/>
      <button onclick="login()">Login</button>
      <p id="error" style="color: #f87171; text-align:center;"></p>
    </div>

    <div id="student-box" class="hidden">
      <h1>Welcome, <span id="student-name"></span></h1>
      <p>Class every Monday at 8:30 PM ðŸ‡±ðŸ‡§ / 6:30 PM ðŸ‡¬ðŸ‡§</p>
      <button onclick="joinZoom()">Join Zoom</button>
      <div class="log-box" id="student-log"></div>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <div id="admin-box" class="hidden">
      <h1>Admin Panel</h1>
      <button onclick="joinZoom()">Join Zoom</button>
      <div class="log-box" id="admin-log">
        Attendance is saved directly in your Google Sheet.
      </div>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </div>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby0bbccWl0dOKbE0LAelKXg21-uCFvDpjYxSQs0kwybF1Jx0dhRJSq3YdCMxbbKloKm/exec";
    let zoomLink = "";

    function login() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const errorElem = document.getElementById("error");

      if (!username || !password) {
        errorElem.textContent = "Please enter both fields.";
        return;
      }

      fetch(WEB_APP_URL, {
        method: "POST",
        contentType: "application/json",
        body: JSON.stringify({ username, password })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          zoomLink = data.zoomLink;
          errorElem.textContent = "";
          document.getElementById("login-box").classList.add("hidden");

          if (data.role === "student") {
            document.getElementById("student-box").classList.remove("hidden");
            document.getElementById("student-name").textContent = username;
            const now = new Date().toLocaleString();
            document.getElementById("student-log").innerHTML = `Attendance logged at: <strong>${now}</strong>`;
          } else if (data.role === "admin") {
            document.getElementById("admin-box").classList.remove("hidden");
          }
        } else {
          errorElem.textContent = data.error || "Login failed.";
        }
      })
      .catch(err => {
        errorElem.textContent = "Error connecting to server.";
        console.error(err);
      });
    }

    function joinZoom() {
      if (zoomLink) {
        window.open(zoomLink, "_blank");
      } else {
        alert("Zoom link not available.");
      }
    }

    function logout() {
      document.getElementById("login-box").classList.remove("hidden");
      document.getElementById("student-box").classList.add("hidden");
      document.getElementById("admin-box").classList.add("hidden");
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
      document.getElementById("error").textContent = "";
    }
  </script>
</body>
</html>
